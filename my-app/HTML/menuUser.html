<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MENU</title>
    <link rel="shortcut icon" href="/IMAGENES/iconSena.png">
    <link rel="stylesheet" href="/CSS/menu.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    
    
</head>
<body class="light-mode">
    <!--todo este es el encabezado -->
    <div class="app-container">
        <div class="app-header">
            <div class="app-header-left">
                <button class="navbar-toggle" id="navbar-toggle" title="Toggle Navbar">
                    <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="24" height="24" viewBox="0 0 24 24">
                        <path d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
                <a href="https://oferta.senasofiaplus.edu.co/sofia-oferta/" target="_blank">
                    <img src="/IMAGENES/iconSena.png" style="height: 50px; border-radius: 20px" alt="icono sena">
                </a>
                <p class="app-name">SENA DREAM</p>
                
            </div>
            <div class="app-header-right">
                <button class="mode-switch" title="Switch Theme" id=".mode-switch">
                    <svg class="moon" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="24" height="24" viewBox="0 0 24 24">
                        <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
                </button>
                <div class="profile-container">
                    <button class="profile-btn" id="profile-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-person" viewBox="0 0 24 24">
                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zM12 14c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                        </svg>
                        <span id="nombre-usuario">User</span>
                        <svg id="chevron-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                        </svg>
                    </button>
                    <ul class="profile-dropdown" id="profile-dropdown">
                        <li><a href="/index.html" onclick="cerrarSesion()">Cerrar Sesi√≥n</a></li>
                    </ul>
                    <script>
                        document.getElementById('profile-btn').addEventListener('click', function() {
                            var dropdown = document.getElementById('profile-dropdown');
                            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
                        });
                    </script>
                </div>
            </div>
        </div>
        <!--Aqui es el iconos de navegar-->
        <!--Aqui es el icono de la casa-->
        <div class="app-content">
            <div class="app-sidebar" id="app-sidebar">
                <a href="" class="app-sidebar-link active">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                        <polyline points="9 22 9 12 15 12 15 22" />
                    </svg>
                </a>
                <!--Aqui es el icono de la persona-->
                <a href="/HTML/huespedUser.html" class="app-sidebar-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-person" viewBox="0 0 24 24">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zM12 14c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                </a>
                <!--Aqui es el icono de la habitaciones-->
                <a href="/HTML/habitacionesUser.html" class="app-sidebar-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-bed">
                        <path d="M3 7h18v10H3z" />
                        <path d="M3 7v10" />
                        <path d="M21 7v10" />
                        <path d="M3 12h18" />
                        <path d="M7 7v5" />
                        <path d="M17 7v5" />
                    </svg>
                </a>
                <!--Aqui es el icono de la tareas-->
                <a href="/HTML/tareasUser.html" class="app-sidebar-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                        <line x1="16" y="2" x2="16" y2="6" />
                        <line x1="8" y1="2" x2="8" y2="6" />
                        <line x1="3" y1="10" x2="21" y2="10" />
                    </svg>
                </a>
                <!--Aqui es el icono de la cuenta-->
                <a href="/HTML/cuentaUser.html" class="app-sidebar-link">
                    <svg class="link-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="feather feather-file-text" viewBox="0 0 24 24">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                        <polyline points="14 2 14 8 20 8" />
                        <line x1="16" y1="13" x2="8" y2="13" />
                        <line x1="16" y1="17" x2="8" y2="17" />
                        <polyline points="10 9 9 9 8 9" />
                    </svg>
                </a>
            </div>
            <!--Ya empieza todo dentro de los el menu-->
             
            <div class="projects-section scrollable">
                <div class="projects-section-header" style="margin-bottom: 0px;">
                    <!-- <p>BIENVENIDO</p> -->
                    
                    <div id="calendario1"></div>
                   
                    
                </div>
                
                <div class="contenedor-reservas-btn">
                    <button id="reservas-btn" class="reservas-btn">Reservar Habitaci√≥n</button>
                </div>
                <table border="1" class="tabala1">
                    <thead>
                        <tr class="header1">
                            <th>ID</th>
                            <th>Habitaci√≥n</th>
                            <th>Hu√©sped</th>
                            <th>Fecha Ingreso</th>
                            <th>Fecha Salida</th>
                            <th>Abono</th>
                            <th>Cantidad de Acompa√±antes</th> <!-- Nueva columna -->
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaReservas" class="contenido"></tbody>
                </table>

<!-- Modal para editar reserva -->
<div id="editarReservaModal" class="modal">
    <div class="modal-content">
        <span class="close" id="closeEditarModal">&times;</span>
        <h2>Editar Reserva</h2>
        <form id="editarReservaForm">
            <label for="editarNumeroHabitacion">N√∫mero de Habitaci√≥n:</label>
            <input type="number" id="editarNumeroHabitacion" name="editarNumeroHabitacion" required>

            <label for="editarIdHuesped">ID Hu√©sped:</label>
            <input type="number" id="editarIdHuesped" name="editarIdHuesped" required>

            <label>Tipo de Persona:</label>
            <div>
                <label>
                    <input type="radio" name="editarTipoPersona" value="funcionario" required>
                    Funcionario
                </label>
                <label>
                    <input type="radio" name="editarTipoPersona" value="externa" required>
                    Persona Externa
                </label>
            </div>

            <label for="editarFechaIngreso">Fecha de Ingreso:</label>
            <input type="date" id="editarFechaIngreso" name="editarFechaIngreso" required>

            <label for="editarFechaSalida">Fecha de Salida:</label>
            <input type="date" id="editarFechaSalida" name="editarFechaSalida" required>

            <label for="editarAbono">Abono:</label>
            <input type="number" id="editarAbono" name="editarAbono">

            <label for="editarCantidadAcompanantes">Cantidad de Acompa√±antes:</label>
            <input type="number" id="editarCantidadAcompanantes" name="editarCantidadAcompanantes" min="0" max="10">

            <!-- ‚úÖ Opci√≥n de Minibar -->
            <label for="editarUsoMinibar">
                <input type="checkbox" id="editarUsoMinibar" name="editarUsoMinibar" onchange="toggleMinibarEditar()">
                ¬øConsumi√≥ del minibar?
            </label>

            <div id="editarDetalleMinibar" style="display: none;">
                <label for="editarProductoMinibar">Producto:</label>
                <input type="text" id="editarProductoMinibar" name="editarProductoMinibar">

                <label for="editarCantidadMinibar">Cantidad:</label>
                <input type="number" id="editarCantidadMinibar" name="editarCantidadMinibar">
            </div>

            <!-- ‚úÖ Bot√≥n para agregar acompa√±antes -->
            <button type="button" onclick="agregarAcompananteEditar()">Agregar Acompa√±ante</button>

            <div id="editarAcompanantesContainer">
                <!-- Aqu√≠ se agregar√°n los acompa√±antes din√°micamente -->
            </div>

            <button type="button" onclick="guardarEdicionReserva()">Guardar Cambios</button>
        </form>
    </div>
</div>

                <!-- Modal de Reservas -->
                <div id="mensajeModal" class="modal">
                    <div class="modal-content">
                        <span class="close">&times;</span>
                        <h2>Reservas</h2>
                        <form id="reservaForm">
                            <label for="numeroHabitacion">N√∫mero de Habitaci√≥n:</label>
                            <select id="numeroHabitacion" name="numeroHabitacion" required>
                                <option value="">Seleccione una habitaci√≥n</option>
                            </select>
                        
                            <label for="idHuesped">Documento de Hu√©sped:</label>
                            <input type="number" id="idHuesped" name="idHuesped" required>
                            <label>Tipo de Persona:</label>
                            <div>
                                <label>
                                    <input type="radio" name="tipoPersona" value="funcionario" required>
                                    Funcionario
                                </label>
                                <label>
                                    <input type="radio" name="tipoPersona" value="externa" required>
                                    Persona Externa
                                </label>
                            </div>
                            <label for="fechaIngreso">Fecha de Ingreso:</label>
                            <input type="date" id="fechaIngreso" name="fechaIngreso" required>
                        
                            <label for="fechaSalida">Fecha de Salida:</label>
                            <input type="date" id="fechaSalida" name="fechaSalida" required>
                        
                            <label for="abono">Abono:</label>
                            <input type="number" id="abono" name="abono">

                            <!-- Nuevo campo para cantidad de acompa√±antes -->
                            <label for="cantidadAcompanantes">Cantidad de Acompa√±antes:</label>
                            <input type="number" id="cantidadAcompanantes" name="cantidadAcompanantes"min="0" max="10">

                            <body onload="obtenerTodasLasHabitaciones()">
                            <button  type="button" onclick="hacerReserva()">Reservar</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> <link href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.11.3/main.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.11.3/main.min.js"></script>


    <script>
        // Obtener el modal



        var modal = document.getElementById("mensajeModal");

        // Obtener el bot√≥n que abre el modal
        var btn = document.getElementById("reservas-btn");

        // Obtener el elemento <span> que cierra el modal
        var span = document.getElementsByClassName("close")[0];

        // Cuando el usuario hace clic en el bot√≥n, abre el modal
        btn.onclick = function() {
            modal.style.display = "block";
        }

        // Cuando el usuario hace clic en <span> (x), cierra el modal
        span.onclick = function() {
            modal.style.display = "none";
        }

        // Cuando el usuario hace clic en cualquier lugar fuera del modal, lo cierra
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        // Alternar entre modo oscuro y claro
        document.querySelector('.mode-switch').addEventListener('click', function() {
            console.log('Alternando modo oscuro');
            document.documentElement.classList.toggle('dark-mode');
            document.documentElement.classList.toggle('light-mode');
            localStorage.setItem('darkMode', document.documentElement.classList.contains('dark-mode'));
        });

        // Alternar visibilidad de la barra de navegaci√≥n
        document.getElementById('navbar-toggle').addEventListener('click', function() {
            var sidebar = document.getElementById('app-sidebar');
            sidebar.classList.toggle('hidden');
            console.log('Formulario enviado');
        });

        // Mantener el modo oscuro al cambiar de vista
        if (localStorage.getItem('darkMode') === 'true') {
            document.documentElement.classList.add('dark-mode');
            document.documentElement.classList.remove('light-mode');
        } else {
            document.documentElement.classList.add('light-mode');
            document.documentElement.classList.remove('dark-mode');
        }

        

// ¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫
// Calendario de reservas
document.addEventListener('DOMContentLoaded', function () {
    var calendarEl = document.getElementById('calendario1');

    if (!calendarEl) {
        console.error('‚ö†Ô∏è No se encontr√≥ el elemento con ID "calendario1". Verifica el HTML.');
        return;
    }

    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'es',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        events: function (fetchInfo, successCallback, failureCallback) {
            fetch('/api/calendario')
                .then(response => response.json())
                .then(data => {
                    console.log('‚úÖ Datos recibidos:', data);

                    if (!Array.isArray(data)) {
                        console.warn('‚ö†Ô∏è La API no devolvi√≥ un array. Verifica la respuesta.');
                        return successCallback([]);
                    }

                    const hoy = new Date();
                    hoy.setHours(0, 0, 0, 0); // üîç Limpiamos la fecha de hoy

                    const eventos = data.map(reserva => {
                        let fechaIngreso = new Date(reserva.fechaIngreso);
                        let fechaSalida = new Date(reserva.fechaSalida);

                        fechaIngreso.setHours(0, 0, 0, 0);
                        fechaSalida.setHours(23, 59, 59, 999); // ‚úÖ Ajustamos fechaSalida al final del d√≠a

                        let colorEvento = 'blue'; // üîµ Reserva futura

                        if (hoy > fechaSalida) {
                            colorEvento = 'red'; // üî¥ Evento pasado
                        } else if (hoy >= fechaIngreso && hoy <= fechaSalida) {
                            colorEvento = 'green'; // üü¢ Evento en curso
                        }

                        return {
                            title: `Habitaci√≥n ${reserva.numeroHabitacion}`,
                            start: fechaIngreso.toISOString().split('T')[0],
                            end: fechaSalida.toISOString().split('T')[0],
                            color: colorEvento
                        };
                    });

                    console.log('üìÖ Eventos procesados:', eventos);
                    successCallback(eventos);
                })
                .catch(error => {
                    console.error('‚ùå Error al cargar los eventos:', error);
                    failureCallback(error);
                });
        }
    });

    calendar.render();
});
// ¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫¬∫
// Funci√≥n para enviar los datos de la reserva||||||||||||||||||
    document.addEventListener('DOMContentLoaded', () => {
    obtenerHabitacionesLibres();
    obtenerReservas();

    document.getElementById('reservaForm').addEventListener('submit', function(event) {
        event.preventDefault();
        hacerReserva();
    });
});
// obtener habitaciones libres



function obtenerTodasLasHabitaciones() {
    fetch('/api/habitaciones')
        .then(response => response.json())
        .then(data => {
            const select = document.getElementById('numeroHabitacion');
            select.innerHTML = '<option value="">Seleccione una habitaci√≥n</option>';

            data.forEach(habitacion => {
                const ocupada = habitacion.ocupada === 1 ? ' (Ocupada)' : ' (Libre)';
                const option = document.createElement('option');
                option.value = habitacion.numeroHabitacion;
                option.textContent = `Habitaci√≥n ${habitacion.numeroHabitacion} ${ocupada}`;
                select.appendChild(option);
            });
        })
        .catch(error => console.error('Error al obtener habitaciones:', error));
}





// Hacer reserva
function hacerReserva() {
    // Capturar el valor del tipo de persona
    const tipoPersonaInput = document.querySelector('input[name="tipoPersona"]:checked');
    if (!tipoPersonaInput) {
        Swal.fire('Error', 'Por favor selecciona el tipo de persona.', 'error');
        return;
    }

    const tipoPersona = tipoPersonaInput.value;

    // Construir el objeto de la reserva
    const reserva = {
        numeroHabitacion: document.getElementById('numeroHabitacion').value,
        idHuesped: document.getElementById('idHuesped').value,
        fechaIngreso: document.getElementById('fechaIngreso').value,
        fechaSalida: document.getElementById('fechaSalida').value,
        abono: document.getElementById('abono').value || 0,
        cantidadAcompanantes: document.getElementById('cantidadAcompanantes').value || 0, // Si est√° vac√≠o, asigna 0,
        tipoPersona,
        minibar: document.getElementById('usoMinibar')?.checked
            ? {
                  producto: document.getElementById('productoMinibar')?.value || '',
                  cantidad: document.getElementById('cantidadMinibar')?.value || 0
              }
            : null
    };

    // Validar que los campos obligatorios est√©n completos
    if (!reserva.numeroHabitacion || !reserva.idHuesped || !reserva.fechaIngreso || !reserva.fechaSalida) {
        Swal.fire('Error', 'Por favor completa todos los campos obligatorios.', 'error');
        return;
    }

    // Enviar los datos al backend
    fetch('/api/reservas', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(reserva)
    })
        .then(response => {
            if (!response.ok) {
                return response.json().then(err => {
                    console.error('Error del servidor:', err);
                    throw new Error('Error al realizar la reserva');
                });
            }
            return response.json();
        })
        .then(() => {
            Swal.fire({
                title: '¬°Reserva exitosa!',
                text: 'La reserva se ha realizado correctamente.',
                icon: 'success',
                confirmButtonText: 'Aceptar'
            }).then(() => {
                modal.style.display = 'none';
                location.reload(); // Recargar la p√°gina para actualizar la tabla
            });
        })
        .catch(error => {
            console.error('Error al hacer la reserva:', error);
            Swal.fire('Error', 'No se pudo realizar la reserva. Intenta nuevamente.', 'error');
        });
}
// ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||



// inicio crud
document.addEventListener('DOMContentLoaded', () => {
    obtenerReservas();
});
// Funci√≥n mostrarlas reservas


// Obtener una reserva por c√≥digo
document.addEventListener('DOMContentLoaded', () => {
    obtenerReservas();
});

function obtenerReservas() {
    fetch('/api/reserva')
        .then(response => response.json())
        .then(data => {
            console.log('Datos de reservas recibidos:', data); // Verifica los datos en la consola
            const tabla = document.getElementById('tablaReservas');
            tabla.innerHTML = '';

            data.forEach(reserva => {
                const fechaIngreso = new Date(reserva.fechaIngreso).toLocaleDateString('es-ES');
                const fechaSalida = new Date(reserva.fechaSalida).toLocaleDateString('es-ES');

                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${reserva.codigoReserva}</td>
                    <td>${reserva.numeroHabitacion}</td>
                    <td>${reserva.idHuesped}</td>
                    <td>${fechaIngreso}</td>
                    <td>${fechaSalida}</td>
                    <td>${reserva.abono}</td>
                    <td>${reserva.cantidadAcompa√±ante || 0}</td> <!-- Cambiar a "cantidadAcompa√±ante" -->
                    <td>
                        <button onclick="editarReserva(${reserva.codigoReserva})">‚úèÔ∏è Editar</button>
                        <button onclick="eliminarReserva(${reserva.codigoReserva})">‚ùå Eliminar</button>
                    </td>
                `;
                tabla.appendChild(fila);
            });
        })
        .catch(error => console.error('Error al obtener reservas:', error));
}


// Editar reserva
function editarReserva(codigoReserva) {
    fetch(`/api/reserva/${codigoReserva}`)
        .then(response => {
            if (!response.ok) {
                throw new Error(`Error en la respuesta del servidor: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('Datos de la reserva:', data); // Verifica los datos en la consola

            // Asignar valores a los campos del modal
            document.getElementById('editarNumeroHabitacion').value = data.numeroHabitacion;
            document.getElementById('editarIdHuesped').value = data.idHuesped;
            document.getElementById('editarFechaIngreso').value = data.fechaIngreso.split('T')[0];
            document.getElementById('editarFechaSalida').value = data.fechaSalida.split('T')[0];
            document.getElementById('editarAbono').value = data.abono;
            document.getElementById('editarCantidadAcompanantes').value = data.cantidadAcompa√±ante || 0;

            // Seleccionar el radio button de tipo de persona
            const tipoPersonaRadios = document.getElementsByName('editarTipoPersona');
            tipoPersonaRadios.forEach(radio => {
                radio.checked = (radio.value === data.tipoPersona);
            });

            // Mostrar los acompa√±antes en el contenedor
            const container = document.getElementById('editarAcompanantesContainer');
            container.innerHTML = ''; // Limpiar el contenedor antes de agregar nuevos acompa√±antes

            data.acompanantes.forEach((acompanante, index) => {
                const acompananteDiv = document.createElement('div');
                acompananteDiv.classList.add('acompanante');

                acompananteDiv.innerHTML = `
                    <label for="editarDocumentoAcompanante${index}">Documento Acompa√±ante ${index + 1}:</label>
                    <input type="number" id="editarDocumentoAcompanante${index}" name="editarDocumentoAcompanante" value="${acompanante.documento}" required>
                `;

                container.appendChild(acompananteDiv);
            });

            // Mostrar el modal
            document.getElementById('editarReservaModal').style.display = 'block';
            // Guardar el c√≥digo de reserva en un atributo del formulario
            document.getElementById('editarReservaForm').dataset.codigoReserva = codigoReserva;
        })
        .catch(error => {
            console.error('Error al obtener la reserva:', error);
            Swal.fire('Error', 'No se pudo obtener la reserva. Verifica la conexi√≥n con el servidor.', 'error');
        });
}

// Eliminar reserva
function eliminarReserva(codigoReserva) {
    Swal.fire({
        title: '¬øEst√°s seguro?',
        text: 'Esta acci√≥n no se puede deshacer.',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'S√≠, eliminar',
        cancelButtonText: 'Cancelar'
    }).then((result) => {
        if (result.isConfirmed) {
            fetch(`/api/reserva/${codigoReserva}`, {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => {
                        console.error('Error del servidor:', err);
                        throw new Error(err.message || 'Error al eliminar la reserva');
                    });
                }
                return response.json();
            })
            .then(data => {
                Swal.fire('Eliminado', data.message, 'success')
                    .then(() => location.reload()); // Recargar la p√°gina para actualizar la tabla
            })
            .catch(error => {
                console.error('Error al eliminar la reserva:', error);
                Swal.fire('Error', 'No se pudo eliminar la reserva. Intenta nuevamente.', 'error');
            });
        }
    });
}

// Fin crud


        // Llamar a la funci√≥n para obtener y mostrar las reservas actuales al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', obtenerReservas);

    // Funci√≥n para guardar los cambios de la edici√≥n
    function guardarEdicionReserva() {
    const codigoReserva = document.getElementById('editarReservaForm').dataset.codigoReserva;

    // Obtener el tipo de persona seleccionado
    const tipoPersonaRadio = document.querySelector('input[name="editarTipoPersona"]:checked');
    if (!tipoPersonaRadio) {
        Swal.fire('Error', 'Por favor selecciona el tipo de persona.', 'error');
        return;
    }

    const reserva = {
        numeroHabitacion: document.getElementById('editarNumeroHabitacion').value,
        idHuesped: document.getElementById('editarIdHuesped').value,
        tipoPersona: tipoPersonaRadio.value,
        fechaIngreso: document.getElementById('editarFechaIngreso').value,
        fechaSalida: document.getElementById('editarFechaSalida').value,
        abono: document.getElementById('editarAbono').value || 0,
        cantidadAcompa√±ante: document.getElementById('editarCantidadAcompanantes').value || 0,
        minibar: document.getElementById('editarUsoMinibar').checked
            ? {
                  producto: document.getElementById('editarProductoMinibar').value,
                  cantidad: document.getElementById('editarCantidadMinibar').value
              }
            : null,
        acompanantes: Array.from(
            document.querySelectorAll('#editarAcompanantesContainer .acompanante')
        ).map(acompananteDiv => {
            const documentoInput = acompananteDiv.querySelector('input[name="editarDocumentoAcompanante"]');
            return {
                documento: documentoInput ? documentoInput.value : null
            };
        }).filter(acompanante => acompanante.documento) // Filtrar acompa√±antes con documento v√°lido
    };

    // Validar campos obligatorios
    if (!reserva.numeroHabitacion || !reserva.idHuesped || !reserva.fechaIngreso || !reserva.fechaSalida) {
        Swal.fire('Error', 'Por favor completa todos los campos obligatorios.', 'error');
        return;
    }

    // Enviar los datos al backend
    fetch(`/api/reserva/${codigoReserva}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(reserva)
    })
        .then(response => {
            if (!response.ok) {
                return response.json().then(err => {
                    console.error('Error del servidor:', err);
                    throw new Error('Error al actualizar la reserva');
                });
            }
            return response.json();
        })
        .then(() => {
            Swal.fire('Reserva actualizada', 'Los cambios han sido guardados.', 'success').then(() => {
                document.getElementById('editarReservaModal').style.display = 'none';
                obtenerReservas();
                actualizarCalendario();
            });
        })
        .catch(error => {
            console.error('Error al actualizar la reserva:', error);
            Swal.fire('Error', 'No se pudo actualizar la reserva. Verifica la conexi√≥n con el servidor.', 'error');
        });
}
    // Cerrar modal de edici√≥n al hacer clic en "X"
    document.getElementById('closeEditarModal').onclick = function() {
        document.getElementById('editarReservaModal').style.display = 'none';
    };

    // Cerrar modal de edici√≥n al hacer clic fuera del modal
    window.onclick = function(event) {
        const modal = document.getElementById('editarReservaModal');
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    };

    // Cerrar modal de reserva al hacer clic en "X"
    document.querySelectorAll('.close').forEach(closeBtn => {
        closeBtn.onclick = function() {
            const modal = this.closest('.modal');
            if (modal) {
                modal.style.display = 'none';
            }
        };
    });

    // Funci√≥n para actualizar el calendario
    function actualizarCalendario() {
        const calendarEl = document.getElementById('calendario1');
        if (calendarEl) {
            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'es',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                events: function (fetchInfo, successCallback, failureCallback) {
                    fetch('/api/calendario')
                        .then(response => response.json())
                        .then(data => {
                            const eventos = data.map(reserva => {
                                let fechaIngreso = new Date(reserva.fechaIngreso);
                                let fechaSalida = new Date(reserva.fechaSalida);

                                fechaIngreso.setHours(0, 0, 0, 0);
                                fechaSalida.setHours(23, 59, 59, 999);

                                let colorEvento = 'blue'; // Reserva futura

                                const hoy = new Date();
                                hoy.setHours(0, 0, 0, 0);

                                if (hoy > fechaSalida) {
                                    colorEvento = 'red'; // Evento pasado
                                } else if (hoy >= fechaIngreso && hoy <= fechaSalida) {
                                    colorEvento = 'green'; // Evento en curso
                                }

                                return {
                                    title: `Habitaci√≥n ${reserva.numeroHabitacion}`,
                                    start: fechaIngreso.toISOString().split('T')[0],
                                    end: fechaSalida.toISOString().split('T')[0],
                                    color: colorEvento
                                };
                            });

                            successCallback(eventos);
                        })
                        .catch(error => {
                            console.error('Error al cargar los eventos:', error);
                            failureCallback(error);
                        });
                }
            });

            calendar.render();
        }
    }

    // Funci√≥n para agregar acompa√±antes din√°micamente
    function agregarAcompanante() {
        const container = document.getElementById('acompanantesContainer');

        // Crear un contenedor para el acompa√±ante
        const acompananteDiv = document.createElement('div');
        acompananteDiv.classList.add('acompanante');

        // Crear campo para el documento del acompa√±ante
        acompananteDiv.innerHTML = `
            <label for="documentoAcompanante">Documento:</label>
            <input type="number" name="documentoAcompanante" required>
            <button type="button" onclick="eliminarAcompanante(this)">Eliminar</button>
        `;

        container.appendChild(acompananteDiv);
    }

    // Funci√≥n para eliminar un acompa√±ante
    function eliminarAcompanante(button) {
        const acompananteDiv = button.parentElement;
        acompananteDiv.remove();
    }

    // Funci√≥n para mostrar/ocultar los campos del minibar
    function toggleMinibar() {
        const minibarDetalle = document.getElementById('detalleMinibar');
        const usoMinibar = document.getElementById('usoMinibar');

        if (usoMinibar.checked) {
            minibarDetalle.style.display = 'block';
        } else {
            minibarDetalle.style.display = 'none';
        }
    }

    function agregarAcompananteEditar() {
    const container = document.getElementById('editarAcompanantesContainer');
    const cantidadAcompanantes = parseInt(document.getElementById('editarCantidadAcompanantes').value, 10);

    // Validar que el n√∫mero ingresado sea v√°lido
    if (isNaN(cantidadAcompanantes) || cantidadAcompanantes < 0) {
        Swal.fire('Error', 'Por favor ingresa un n√∫mero v√°lido de acompa√±antes.', 'error');
        return;
    }

    // Limpiar el contenedor de acompa√±antes antes de agregar nuevos
    container.innerHTML = '';

    // Generar las casillas de documentos seg√∫n la cantidad ingresada
    for (let i = 0; i < cantidadAcompanantes; i++) {
        const acompananteDiv = document.createElement('div');
        acompananteDiv.classList.add('acompanante');

        acompananteDiv.innerHTML = `
            <label for="editarDocumentoAcompanante${i}">Documento Acompa√±ante ${i + 1}:</label>
            <input type="number" id="editarDocumentoAcompanante${i}" name="editarDocumentoAcompanante" required>
        `;

        container.appendChild(acompananteDiv);
    }
}

    // Funci√≥n para mostrar/ocultar los campos del minibar en el modal de edici√≥n
    function toggleMinibarEditar() {
        const minibarDetalle = document.getElementById('editarDetalleMinibar');
        const usoMinibar = document.getElementById('editarUsoMinibar');

        if (usoMinibar.checked) {
            minibarDetalle.style.display = 'block';
        } else {
            minibarDetalle.style.display = 'none';
        }
    }

    function iniciarSesion() {
    const nombreUsuario = document.getElementById('nombreUsuario').value;
    const password = document.getElementById('password').value;

    fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ nombreUsuario, password })
    })
    .then(response => {
        if (!response.ok) {
            return response.json().then(err => {
                throw new Error(err.message || 'Error al iniciar sesi√≥n');
            });
        }
        return response.json();
    })
    .then(data => {
        if (data.success) {
            // Guardar el nombre de usuario en localStorage
            localStorage.setItem('nombreUsuario', data.nombreUsuario);

            // Redirigir a la URL proporcionada
            window.location.href = data.redirect;
        } else {
            Swal.fire('Error', data.message, 'error');
        }
    })
    .catch(error => {
        console.error('Error al iniciar sesi√≥n:', error);
        Swal.fire('Error', 'No se pudo iniciar sesi√≥n. Intenta nuevamente.', 'error');
    });
}

    document.addEventListener('DOMContentLoaded', () => {
    const nombreUsuario = localStorage.getItem('nombreUsuario');
    if (nombreUsuario) {
        document.getElementById('nombre-usuario').textContent = nombreUsuario;
    }
});
function cerrarSesion() {
            localStorage.removeItem('nombreUsuario');
        }
</script>
</body>
</html>